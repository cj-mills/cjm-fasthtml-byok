# Security


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Key Generation

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-byok/blob/main/cjm_fasthtml_byok/core/security.py#L22"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_encryption_key

>  generate_encryption_key (password:Optional[str]=None,
>                               salt:Optional[bytes]=None)

*Generate or derive an encryption key.*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>password</td>
<td>Optional</td>
<td>None</td>
<td>Optional password to derive key from</td>
</tr>
<tr>
<td>salt</td>
<td>Optional</td>
<td>None</td>
<td>Optional salt for key derivation (required if password
provided)</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bytes</strong></td>
<td></td>
<td><strong>32-byte encryption key suitable for Fernet</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-byok/blob/main/cjm_fasthtml_byok/core/security.py#L43"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_or_create_app_key

>  get_or_create_app_key (secret_key:str)

*Get or create an app-specific encryption key derived from the app’s
secret key.*

<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 38%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>secret_key</td>
<td>str</td>
<td>The application’s secret key (from FastHTML app config)</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bytes</strong></td>
<td><strong>Encryption key for the app</strong></td>
</tr>
</tbody>
</table>

## Encryption/Decryption

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-byok/blob/main/cjm_fasthtml_byok/core/security.py#L52"
target="_blank" style="float:right; font-size:smaller">source</a>

### KeyEncryptor

>  KeyEncryptor (encryption_key:Optional[bytes]=None)

*Handles encryption and decryption of API keys.*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>encryption_key</td>
<td>Optional</td>
<td>None</td>
<td>Encryption key to use. If None, generates a new one</td>
</tr>
</tbody>
</table>

## Security Checks

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-byok/blob/main/cjm_fasthtml_byok/core/security.py#L134"
target="_blank" style="float:right; font-size:smaller">source</a>

### check_https

>  check_https (request)

*Check if the request is using HTTPS.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>request</td>
<td></td>
<td>FastHTML/Starlette request object</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if using HTTPS, False otherwise</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-byok/blob/main/cjm_fasthtml_byok/core/security.py#L141"
target="_blank" style="float:right; font-size:smaller">source</a>

### validate_environment

>  validate_environment (request, require_https:bool=True,
>                            is_production:bool=None)

*Validate the security environment.*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>request</td>
<td></td>
<td></td>
<td>FastHTML/Starlette request object</td>
</tr>
<tr>
<td>require_https</td>
<td>bool</td>
<td>True</td>
<td>Whether to require HTTPS</td>
</tr>
<tr>
<td>is_production</td>
<td>bool</td>
<td>None</td>
<td>Whether running in production (auto-detected if None)</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-byok/blob/main/cjm_fasthtml_byok/core/security.py#L164"
target="_blank" style="float:right; font-size:smaller">source</a>

### mask_key

>  mask_key (key:str, visible_chars:int=4)

*Mask an API key for display purposes.*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>key</td>
<td>str</td>
<td></td>
<td>The API key to mask</td>
</tr>
<tr>
<td>visible_chars</td>
<td>int</td>
<td>4</td>
<td>Number of characters to show at start and end</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>str</strong></td>
<td></td>
<td><strong>Masked key like ‘sk-a…xyz’</strong></td>
</tr>
</tbody>
</table>

## Key Fingerprinting

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-byok/blob/main/cjm_fasthtml_byok/core/security.py#L175"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_key_fingerprint

>  get_key_fingerprint (key:str)

*Generate a fingerprint for an API key (for logging/tracking without
exposing the key).*

<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 38%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>key</td>
<td>str</td>
<td>The API key</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>str</strong></td>
<td><strong>SHA256 fingerprint of the key (first 16 chars)</strong></td>
</tr>
</tbody>
</table>

## Tests

``` python
# Test encryption/decryption
encryptor = KeyEncryptor()
test_key = "sk-1234567890abcdef"
encrypted = encryptor.encrypt(test_key)
decrypted = encryptor.decrypt(encrypted)
assert decrypted == test_key
print(f"✓ Encryption/decryption working")

# Test key masking
masked = mask_key("sk-1234567890abcdef")
assert masked == "sk-1...cdef"
print(f"✓ Key masking: {masked}")

# Test fingerprinting
fp1 = get_key_fingerprint("test-key-1")
fp2 = get_key_fingerprint("test-key-2")
assert fp1 != fp2
assert len(fp1) == 16
print(f"✓ Fingerprinting: {fp1}")
```

    ✓ Encryption/decryption working
    ✓ Key masking: sk-1...cdef
    ✓ Fingerprinting: 1255558df586ae27
